<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SA ID Validator</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 800px; 
            margin: 0 auto; 
            padding: 20px; 
            background-color: #f5f5f5;
        }
        .validator { 
            background: white; 
            border-radius: 8px; 
            padding: 30px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); 
        }
        h1 { 
            font-size: 48px; 
            margin-bottom: 30px; 
            color: #3c3c3c; 
            font-weight: bold;
        }
        .input-section { 
            display: flex; 
            gap: 15px; 
            margin-bottom: 20px; 
        }
        input[type="text"] { 
            flex: 1; 
            padding: 15px; 
            border: 1px solid #ccc; 
            border-radius: 4px; 
            font-size: 16px; 
        }
        button { 
            padding: 15px 30px; 
            background: #3767b9; 
            color: white; 
            border: none; 
            border-radius: 4px; 
            font-size: 16px; 
            cursor: pointer; 
            font-weight: bold;
        }
        button:hover { 
            background: #2557a9; 
        }
        .result { 
            background: #dff0d8; 
            border: 1px solid #b1cea6; 
            color: #468847; 
            padding: 20px; 
            border-radius: 4px; 
            margin-top: 20px; 
            display: none; 
        }
        .result.invalid {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .result h3 {
            margin: 0 0 15px 0;
            font-size: 24px;
        }
        .checkmark {
            display: inline-block;
            width: 24px;
            height: 24px;
            background: #468847;
            border-radius: 50%;
            margin-right: 10px;
            text-align: center;
            line-height: 24px;
            color: white;
            font-weight: bold;
        }
        .history { 
            margin-top: 30px; 
        }
        .history h3 {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        table { 
            width: 100%; 
            border-collapse: collapse; 
            margin-top: 15px;
        }
        th, td { 
            padding: 12px; 
            text-align: left; 
            border-bottom: 1px solid #ddd; 
        }
        th { 
            background-color: #f5f5f5; 
            font-weight: bold;
        }
        tr:hover {
            background-color: #f9f9f9;
        }
        .clear-btn {
            font-size: 14px;
            padding: 8px 16px;
            background: #6c757d;
        }
        .clear-btn:hover {
            background: #5a6268;
        }
    </style>
</head>
<body>
    <div class="validator">
        <h1>SA ID Validator</h1>
        <div class="input-section">
            <input type="text" id="idInput" placeholder="Enter ID number" maxlength="13">
            <button onclick="validateID()">Validate</button>
        </div>
        <div id="result" class="result">
            <h3><span class="checkmark">✓</span><span id="resultTitle">Valid</span></h3>
            <div id="resultText"></div>
        </div>
        <div class="history">
            <h3>
                Validation History 
                <button class="clear-btn" onclick="clearHistory()">Clear</button>
            </h3>
            <table>
                <thead>
                    <tr><th>ID Number</th><th>Result</th></tr>
                </thead>
                <tbody id="historyTable">
                    <tr><td>8001015009087</td><td>Valid</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // SA ID Validator JavaScript - Inline Version
        let validationHistory = JSON.parse(localStorage.getItem('validationHistory')) || [
            { id: '8001015009087', result: 'Valid' }
        ];

        // Load history on page load
        window.onload = function() {
            updateHistoryTable();
        };

        function validateID() {
            const idInput = document.getElementById('idInput');
            const idNumber = idInput.value.trim();
            
            if (!idNumber) {
                alert('Please enter an ID number');
                return;
            }
            
            if (idNumber.length !== 13) {
                showResult(false, 'ID number must be 13 digits');
                addToHistory(idNumber, 'Invalid - Wrong length');
                return;
            }
            
            if (!/^\d{13}$/.test(idNumber)) {
                showResult(false, 'ID number must contain only digits');
                addToHistory(idNumber, 'Invalid - Not numeric');
                return;
            }
            
            // Validate using SA ID rules
            if (isValidSAID(idNumber)) {
                const info = extractIDInfo(idNumber);
                showResult(true, info);
                addToHistory(idNumber, 'Valid');
            } else {
                showResult(false, 'Invalid SA ID number');
                addToHistory(idNumber, 'Invalid');
            }
            
            idInput.value = '';
        }

        function isValidSAID(idNumber) {
            // Check date
            const dob = idNumber.substring(0, 6);
            if (!isValidDate(dob)) return false;
            
            // Luhn algorithm
            return luhnCheck(idNumber);
        }

        function isValidDate(dob) {
            const year = parseInt(dob.substring(0, 2));
            const month = parseInt(dob.substring(2, 4));
            const day = parseInt(dob.substring(4, 6));
            
            if (month < 1 || month > 12) return false;
            if (day < 1 || day > 31) return false;
            
            const daysInMonth = [31, 29, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
            return day <= daysInMonth[month - 1];
        }

        function luhnCheck(idNumber) {
            let sum = 0;
            let alternate = false;
            
            for (let i = idNumber.length - 1; i >= 0; i--) {
                let n = parseInt(idNumber.charAt(i));
                if (alternate) {
                    n *= 2;
                    if (n > 9) n = (n % 10) + 1;
                }
                sum += n;
                alternate = !alternate;
            }
            
            return (sum % 10 === 0);
        }

        function extractIDInfo(idNumber) {
            const year = parseInt(idNumber.substring(0, 2));
            const month = idNumber.substring(2, 4);
            const day = idNumber.substring(4, 6);
            
            // Determine century
            const currentYear = new Date().getFullYear() % 100;
            const fullYear = (year <= currentYear + 5) ? 2000 + year : 1900 + year;
            
            // Calculate age
            const today = new Date();
            const birthDate = new Date(fullYear, parseInt(month) - 1, parseInt(day));
            const age = today.getFullYear() - birthDate.getFullYear() - 
                        (today < new Date(today.getFullYear(), birthDate.getMonth(), birthDate.getDate()) ? 1 : 0);
            
            // Determine gender
            const genderDigits = parseInt(idNumber.substring(6, 10));
            const gender = genderDigits < 5000 ? 'Female' : 'Male';
            
            // Determine citizenship
            const citizenship = idNumber.charAt(10) === '0' ? 'SA Citizen' : 'Permanent Resident';
            
            return {
                dob: fullYear + '-' + month + '-' + day,
                age: age,
                gender: gender,
                citizenship: citizenship
            };
        }

        function showResult(isValid, info) {
            const resultDiv = document.getElementById('result');
            const resultTitle = document.getElementById('resultTitle');
            const resultText = document.getElementById('resultText');
            
            if (isValid && typeof info === 'object') {
                resultDiv.className = 'result';
                resultDiv.style.display = 'block';
                resultTitle.textContent = 'Valid';
                resultText.innerHTML = 
                    '<strong>Date of birth:</strong> ' + info.dob + '<br>' +
                    '<strong>Age:</strong> ' + info.age + '<br>' +
                    '<strong>Gender:</strong> ' + info.gender + '<br>' +
                    '<strong>Citizenship:</strong> ' + info.citizenship;
            } else {
                resultDiv.className = 'result invalid';
                resultDiv.style.display = 'block';
                resultTitle.textContent = 'Invalid';
                resultText.innerHTML = '<strong>Error:</strong> ' + info;
            }
        }

        function addToHistory(idNumber, result) {
            validationHistory.unshift({ id: idNumber, result: result });
            
            // Keep only last 10 entries
            if (validationHistory.length > 10) {
                validationHistory = validationHistory.slice(0, 10);
            }
            
            localStorage.setItem('validationHistory', JSON.stringify(validationHistory));
            updateHistoryTable();
        }

        function updateHistoryTable() {
            const tbody = document.getElementById('historyTable');
            tbody.innerHTML = '';
            
            validationHistory.forEach(function(entry) {
                const row = tbody.insertRow();
                row.insertCell(0).textContent = entry.id;
                row.insertCell(1).textContent = entry.result;
            });
        }

        function clearHistory() {
            validationHistory = [];
            localStorage.removeItem('validationHistory');
            updateHistoryTable();
        }

        // Enter key support
        document.getElementById('idInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                validateID();
            }
        });
    </script>
</body>
</html>
